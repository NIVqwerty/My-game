//========================================================================
//! @file       Main.cpp
//{=======================================================================
//!
//! @brief      <Заголовок>\n
//! @brief      <Подзаголовок>
//!
//! @version    [Version 0.01 alpha, build 1]
//! @author     Copyright (C) <Автор>, <Год> (<Имя> <Почта>)
//! @date       <Дата>
//!
//! @par        Протестировано
//!           - (TODO: список платформ)
//!
//! @todo     - (TODO: список ближайших планов по этому файлу)
//!
//! @bug      - (TODO: список найденных ошибок в этом файле)
//!
//! @par        История изменений файла
//!           - Версия 0.01 Alpha
//!             - Только что созданный файл
//!
//}=======================================================================

#include "TXLib.h"
struct Button
{
    int x;
    int y;
    int w;
    int h;
    const char* text;
    bool visible;

    void draw()
    {
        if(txMouseX()>x && txMouseX()<x+w &&
                txMouseY()>y && txMouseY()<y+h)
        {
        txSetColor (TX_WHITE, 3);
        txSetFillColor (TX_ORANGE);
        Win32::RoundRect (txDC(), x, y, x+w, y+h, 30, 30);
        txSelectFont("Times New Roman", 30);
        txSetColor (TX_RED);
        txDrawText(x, y, x+w, y+h, text);
        }
        else
        {
        txSetColor (TX_WHITE, 3);
        txSetFillColor (TX_YELLOW);
        Win32::RoundRect (txDC(), x, y, x+w, y+h, 30, 30);
        txSelectFont("Times New Roman", 30);
        txSetColor (TX_RED);
        txDrawText(x, y, x+w, y+h, text);
        }
    }

    bool click()
    {
        return(txMouseX()>x && txMouseX()<x+w &&
                txMouseY()>y && txMouseY()<y+h &&
                txMouseButtons() == 1 && visible);
    }
};

struct Man
{
    int x;
    int y;
    int w_;
    int h_;
    int w;
    int h;
    HDC pic;
    int xn_kard;
    int yn_kard;



    void draw()
    {
        Win32::TransparentBlt(txDC(), x, y, w_, h_, pic, xn_kard*w,yn_kard*h, w, h, TX_WHITE);
    }

};

int main()
{
txCreateWindow (1280, 720);
txTextCursor (false);

Man man = {0, 0, 100, 100, 100, 100, txLoadImage("Pictures/man.bmp"), 0};
int x_man_old, y_man_old;

    while(!GetAsyncKeyState(VK_ESCAPE))
    {
        txClear();
        txBegin();

        man.draw();
        txSetColor(RGB(0, 0, 0), 15);
        txRectangle(400, 50, 420, 200);

        x_man_old = man.x;
        y_man_old = man.y;

        if(GetAsyncKeyState(VK_DOWN))
        {
            man.y += 5;
            man.yn_kard = 0;
            man.xn_kard += 1;
            if(man.xn_kard>3) man.xn_kard=0;
            txSleep(60);
        }
        if(GetAsyncKeyState(VK_LEFT))
        {
            man.x -= 5;
            man.xn_kard += 1;
            man.yn_kard = 1;
            if(man.xn_kard>3) man.xn_kard=0;
            txSleep(60);
        }

        if(GetAsyncKeyState(VK_RIGHT))
        {
            man.x += 5;
            man.xn_kard += 1;
            man.yn_kard = 2;
            if(man.xn_kard>3) man.xn_kard=0;
            txSleep(60);
        }
        if(GetAsyncKeyState(VK_UP))
        {
            man.y -= 5;
            man.yn_kard = 3;
            man.xn_kard += 1;
            if(man.xn_kard>3) man.xn_kard=0;
            txSleep(60);
        }



        for(int x=man.x; x<man.x+man.w_; x+=10)
            {
                for(int y=man.y; y<man.y+man.h_; y+=10)
                {
                    if(txGetPixel(x, y) == RGB(0, 0, 0))
                    {
                        man.x = x_man_old;
                        man.y = y_man_old;
                    }
                }
            }

        txEnd();
        txSleep(50);

    }

txDisableAutoPause();
return 0;
}

